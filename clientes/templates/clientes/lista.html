{% extends "lista.html" %}
{% load cliente_extras %}

{% block title %}Clientes{% endblock %}

{% block filtros %}
  <form action="{% url 'clientes_list' %}" method="get" class="filter-form-simple">
    <div class="filter-block">
      <label for="q">Cliente</label>
      <input type="text" id="q" name="q" value="{{ request.GET.q|default_if_none:'' }}">
    </div>
    <span class="filter-separator" aria-hidden="true"></span>
    <div class="filter-block">
      <label for="servicio">Servicio</label>
      <select id="servicio" name="servicio">
        <option value="">Todos</option>
        {% for val, label in servicio_choices %}
          <option value="{{ val }}" {% if servicio == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <span class="filter-separator" aria-hidden="true"></span>
    <div class="filter-actions">
      <button type="submit" class="btn-filter">Filtrar</button>
      <a href="{% url 'clientes_list' %}" class="btn-filter">Limpiar</a>
    </div>
  </form>
  <a href="{% url 'clientes_add' %}?next={{ request.get_full_path|urlencode }}" class="btn-primary">Nuevo cliente</a>
{% endblock %}

{% block tabla_head %}
  <tr>
    <th class="sticky-1 col-actions">Acciones</th>
    <th class="sticky-2">Razón Social</th>
    <th>AC</th>
    <th>Ejecutivo</th>
    <th>Ejecutivo 2</th>
    <th>Ejecutivo de apoyo</th>
    <th>Servicio</th>
    <th>Comisión servicio</th>
  </tr>
{% endblock %}

{% block tabla_body %}
  {% for c in clientes %}
  <tr>
    <td class="sticky-1 col-actions">
      <a class="btn-detalle" href="{% url 'clientes_edit' c.id %}?next={{ request.get_full_path|urlencode }}">Editar</a>
    </td>
    <td class="sticky-2">{{ c.razon_social|default_if_none:"" }}</td>
    <td>{{ c.get_ac_display|default_if_none:"" }}</td>
    <td>{% with exec=c.ejecutivo %}{% if exec %}{{ exec.get_full_name|default:exec.username }}{% endif %}{% endwith %}</td>
    <td>{% with exec2=c.ejecutivo2 %}{% if exec2 %}{{ exec2.get_full_name|default:exec2.username }}{% endif %}{% endwith %}</td>
    <td>
      {% with apoyo=c.ejecutivos_apoyo.all|first %}
        {% if apoyo %}{{ apoyo.get_full_name|default:apoyo.username }}{% endif %}
      {% endwith %}
    </td>
    <td>{{ c.get_servicio_display|default_if_none:"" }}</td>
    <td>{% if c.comision_servicio is not None %}{{ c.comision_servicio|pct:3 }}{% endif %}</td>
  </tr>
  {% empty %}
  <tr><td colspan="8">No hay clientes registrados.</td></tr>
  {% endfor %}
{% endblock %}
